<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mini Prima - Teste de Roteamento e Navega√ß√£o</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .test-result {
            transition: all 0.3s ease;
        }
        .test-result.pass {
            background-color: #dcfce7;
            border-color: #16a34a;
        }
        .test-result.fail {
            background-color: #fef2f2;
            border-color: #dc2626;
        }
        .test-result.warning {
            background-color: #fefce8;
            border-color: #ca8a04;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen py-8">
    <div class="container mx-auto px-4 max-w-6xl">
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h1 class="text-3xl font-bold text-gray-900 mb-2">üß≠ Mini Prima - Teste de Roteamento e Navega√ß√£o</h1>
            <p class="text-gray-600 mb-4">An√°lise completa de rotas, navega√ß√£o e prote√ß√£o de rotas</p>
            
            <!-- Test Controls -->
            <div class="flex flex-wrap gap-4 mb-6">
                <button id="testAllRoutes" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                    üîç Testar Todas as Rotas
                </button>
                <button id="testNavigation" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">
                    üß≠ Testar Navega√ß√£o
                </button>
                <button id="testProtection" class="bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700">
                    üîí Testar Prote√ß√£o
                </button>
                <button id="exportResults" class="bg-orange-600 text-white px-4 py-2 rounded hover:bg-orange-700">
                    üìä Exportar Resultados
                </button>
            </div>

            <!-- Summary Stats -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                <div class="bg-blue-50 p-4 rounded-lg border">
                    <div class="text-2xl font-bold text-blue-600" id="totalRoutes">0</div>
                    <div class="text-sm text-blue-800">Total de Rotas</div>
                </div>
                <div class="bg-green-50 p-4 rounded-lg border">
                    <div class="text-2xl font-bold text-green-600" id="workingRoutes">0</div>
                    <div class="text-sm text-green-800">Rotas Funcionais</div>
                </div>
                <div class="bg-red-50 p-4 rounded-lg border">
                    <div class="text-2xl font-bold text-red-600" id="brokenRoutes">0</div>
                    <div class="text-sm text-red-800">Rotas Quebradas</div>
                </div>
                <div class="bg-yellow-50 p-4 rounded-lg border">
                    <div class="text-2xl font-bold text-yellow-600" id="warningRoutes">0</div>
                    <div class="text-sm text-yellow-800">Avisos</div>
                </div>
            </div>
        </div>

        <!-- Test Results -->
        <div class="grid gap-6">
            <!-- Route Definition Analysis -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-xl font-bold text-gray-900 mb-4">üìã 1. An√°lise de Defini√ß√µes de Rotas</h2>
                <div id="routeDefinitionResults" class="space-y-3">
                    <!-- Results will be populated here -->
                </div>
            </div>

            <!-- Navigation Component Testing -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-xl font-bold text-gray-900 mb-4">üß≠ 2. Teste de Componentes de Navega√ß√£o</h2>
                <div id="navigationResults" class="space-y-3">
                    <!-- Results will be populated here -->
                </div>
            </div>

            <!-- Route Protection Analysis -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-xl font-bold text-gray-900 mb-4">üîí 3. An√°lise de Prote√ß√£o de Rotas</h2>
                <div id="protectionResults" class="space-y-3">
                    <!-- Results will be populated here -->
                </div>
            </div>

            <!-- Detailed Findings -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-xl font-bold text-gray-900 mb-4">üêõ 4. Problemas Identificados</h2>
                <div id="issuesFound" class="space-y-3">
                    <!-- Issues will be populated here -->
                </div>
            </div>
        </div>

        <!-- Export Modal -->
        <div id="exportModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center">
            <div class="bg-white p-6 rounded-lg max-w-md w-full mx-4">
                <h3 class="text-lg font-bold mb-4">üìä Exportar Resultados</h3>
                <div class="space-y-4">
                    <button id="exportJSON" class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700">
                        Exportar como JSON
                    </button>
                    <button id="exportCSV" class="w-full bg-green-600 text-white py-2 rounded hover:bg-green-700">
                        Exportar como CSV
                    </button>
                    <button id="closeModal" class="w-full bg-gray-600 text-white py-2 rounded hover:bg-gray-700">
                        Fechar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Comprehensive routing and navigation analysis
        class RoutingNavigationTester {
            constructor() {
                this.results = {
                    routeDefinitions: [],
                    navigationTests: [],
                    protectionTests: [],
                    issues: []
                };
                this.stats = {
                    total: 0,
                    working: 0,
                    broken: 0,
                    warnings: 0
                };
            }

            // App.tsx Route Definitions Analysis
            analyzeRouteDefinitions() {
                console.log('üîç Analyzing Route Definitions...');
                
                const routeDefinitions = [
                    // Main App Routes
                    { path: '/login', component: 'UnifiedLogin', protected: false, type: 'unified' },
                    { path: '/mock', component: 'MockHome', protected: false, type: 'public' },
                    { path: '/mock1', component: 'MockHome1', protected: false, type: 'public' },
                    { path: '/mock2', component: 'MockHome2', protected: false, type: 'public' },
                    { path: '/mock3', component: 'MockHome3', protected: false, type: 'public' },
                    
                    // Client Routes
                    { path: '/', component: 'Index', protected: false, type: 'public', redirect: 'portal if authenticated' },
                    { path: '/portal', component: 'Portal', protected: true, type: 'client' },
                    { path: '/portal/cases', component: 'PortalCases', protected: true, type: 'client' },
                    { path: '/portal/documents', component: 'PortalDocuments', protected: true, type: 'client' },
                    { path: '/portal/messages', component: 'PortalMessages', protected: true, type: 'client' },
                    { path: '/portal/financial', component: 'PortalFinancial', protected: true, type: 'client' },
                    { path: '/portal/subscriptions', component: 'ClientSubscriptions', protected: true, type: 'client' },
                    { path: '/portal/payment', component: 'PaymentCheckout', protected: true, type: 'client' },
                    { path: '/portal/notifications', component: 'Portal', protected: true, type: 'client', note: 'redirects to Portal' },
                    
                    // Admin Routes
                    { path: '/admin/login', component: 'Navigate to /login', protected: false, type: 'redirect' },
                    { path: '/admin', component: 'AdminDashboard', protected: true, type: 'admin' },
                    { path: '/admin/permissions', component: 'AdminStaffManagement', protected: true, type: 'admin' },
                    { path: '/admin/registrations', component: 'RegistrationManagement', protected: true, type: 'admin' },
                    { path: '/admin/subscriptions', component: 'AdminSubscriptions', protected: true, type: 'admin' },
                    { path: '/admin/analytics', component: 'AdminBusinessIntelligence', protected: true, type: 'admin' },
                    { path: '/admin/clients', component: 'Placeholder (Em desenvolvimento)', protected: true, type: 'admin', issue: 'placeholder' },
                    { path: '/admin/cases', component: 'Placeholder (Em desenvolvimento)', protected: true, type: 'admin', issue: 'placeholder' },
                    { path: '/admin/documents', component: 'Placeholder (Em desenvolvimento)', protected: true, type: 'admin', issue: 'placeholder' },
                    { path: '/admin/financial', component: 'Placeholder (Em desenvolvimento)', protected: true, type: 'admin', issue: 'placeholder' },
                    { path: '/admin/messages', component: 'Placeholder (Em desenvolvimento)', protected: true, type: 'admin', issue: 'placeholder' },
                    { path: '/admin/time-tracking', component: 'TimeTracking', protected: true, type: 'admin' },
                    { path: '/admin/calendar', component: 'Calendar', protected: true, type: 'admin' },
                    { path: '/admin/business-settings', component: 'BusinessSettings', protected: true, type: 'admin' },
                    { path: '/admin/document-templates', component: 'DocumentTemplates', protected: true, type: 'admin' },
                    { path: '/admin/document-generation', component: 'DocumentGeneration', protected: true, type: 'admin' },
                    { path: '/admin/stripe-settings', component: 'StripeSettings', protected: true, type: 'admin' },
                    { path: '/admin/payment-analytics', component: 'PaymentAnalytics', protected: true, type: 'admin' },
                    { path: '/admin/webhook-logs', component: 'WebhookLogs', protected: true, type: 'admin' },
                    { path: '/admin/legal-compliance', component: 'BrazilianLegalCompliance', protected: true, type: 'admin' },
                    { path: '/admin/settings', component: 'Placeholder (Em desenvolvimento)', protected: true, type: 'admin', issue: 'placeholder' },
                    
                    // Staff Routes
                    { path: '/admin/staff/cases', component: 'AdminStaffCases', protected: true, type: 'staff' },
                    { path: '/admin/staff/documents', component: 'AdminStaffDocuments', protected: true, type: 'staff' },
                    { path: '/admin/staff/messages', component: 'AdminStaffMessages', protected: true, type: 'staff' },
                    { path: '/admin/staff/billing', component: 'AdminStaffBilling', protected: true, type: 'staff' },
                    { path: '/admin/staff/time-tracking', component: 'TimeTracking', protected: true, type: 'staff' },
                    { path: '/admin/staff/calendar', component: 'Calendar', protected: true, type: 'staff' },
                    { path: '/admin/staff/document-generation', component: 'DocumentGeneration', protected: true, type: 'staff' },
                    { path: '/admin/staff/clients/:clientId', component: 'Placeholder (Em desenvolvimento)', protected: true, type: 'staff', issue: 'placeholder' },
                    { path: '/admin/staff/cases/new', component: 'Placeholder (Em desenvolvimento)', protected: true, type: 'staff', issue: 'placeholder' },
                    { path: '/admin/staff/cases/:caseId', component: 'Placeholder (Em desenvolvimento)', protected: true, type: 'staff', issue: 'placeholder' },
                    { path: '/admin/staff/cases/:caseId/edit', component: 'Placeholder (Em desenvolvimento)', protected: true, type: 'staff', issue: 'placeholder' },
                    
                    // Catch-all
                    { path: '*', component: 'NotFound', protected: false, type: 'fallback' }
                ];

                // Analyze each route
                routeDefinitions.forEach(route => {
                    let status = 'pass';
                    let message = `Rota ${route.path} definida corretamente`;
                    let issues = [];

                    // Check for issues
                    if (route.issue === 'placeholder') {
                        status = 'warning';
                        message = `Rota ${route.path} tem componente placeholder`;
                        issues.push('Componente n√£o implementado completamente');
                    }

                    // Check route structure
                    if (route.path.includes('/:') && !route.path.includes('*')) {
                        if (!route.component.includes('Placeholder')) {
                            issues.push('Rota param√©trica sem valida√ß√£o de par√¢metros');
                        }
                    }

                    this.results.routeDefinitions.push({
                        path: route.path,
                        component: route.component,
                        protected: route.protected,
                        type: route.type,
                        status,
                        message,
                        issues
                    });

                    if (status === 'pass') this.stats.working++;
                    else if (status === 'fail') this.stats.broken++;
                    else if (status === 'warning') this.stats.warnings++;
                    this.stats.total++;
                });

                this.renderRouteDefinitionResults();
            }

            // Navigation Component Testing
            testNavigationComponents() {
                console.log('üß≠ Testing Navigation Components...');

                const navigationTests = [
                    // AdminSidebar Navigation Links
                    {
                        component: 'AdminSidebar',
                        type: 'admin',
                        links: [
                            { label: 'Dashboard', href: '/admin', status: 'working' },
                            { label: 'Permiss√µes', href: '/admin/permissions', status: 'working' },
                            { label: 'Cadastros', href: '/admin/registrations', status: 'working' },
                            { label: 'Assinaturas', href: '/admin/subscriptions', status: 'working' },
                            { label: 'Analytics', href: '/admin/analytics', status: 'working' },
                            { label: 'Clientes', href: '/admin/clients', status: 'placeholder' },
                            { label: 'Casos', href: '/admin/cases', status: 'placeholder' },
                            { label: 'Documentos', href: '/admin/documents', status: 'placeholder' },
                            { label: 'Financeiro', href: '/admin/financial', status: 'placeholder' },
                            { label: 'Mensagens', href: '/admin/messages', status: 'placeholder' },
                            { label: 'Controle de Tempo', href: '/admin/time-tracking', status: 'working' },
                            { label: 'Calend√°rio e Prazos', href: '/admin/calendar', status: 'working' },
                            { label: 'Gerar Documentos', href: '/admin/document-generation', status: 'working' },
                            { label: 'Templates', href: '/admin/document-templates', status: 'working' },
                            { label: 'Configura√ß√µes Empresariais', href: '/admin/business-settings', status: 'working' },
                            { label: 'Configura√ß√µes Stripe', href: '/admin/stripe-settings', status: 'working' },
                            { label: 'Analytics de Pagamentos', href: '/admin/payment-analytics', status: 'working' },
                            { label: 'Logs de Webhooks', href: '/admin/webhook-logs', status: 'working' },
                            { label: 'üáßüá∑ Compliance Legal', href: '/admin/legal-compliance', status: 'working' },
                            { label: 'Configura√ß√µes do Sistema', href: '/admin/settings', status: 'placeholder' }
                        ]
                    },
                    // Staff Navigation Links
                    {
                        component: 'AdminSidebar (Staff)',
                        type: 'staff',
                        links: [
                            { label: 'Casos', href: '/admin/staff/cases', status: 'working' },
                            { label: 'Documentos', href: '/admin/staff/documents', status: 'working' },
                            { label: 'Mensagens', href: '/admin/staff/messages', status: 'working' },
                            { label: 'Cobran√ßa', href: '/admin/staff/billing', status: 'working' },
                            { label: 'Controle de Tempo', href: '/admin/staff/time-tracking', status: 'working' },
                            { label: 'Calend√°rio e Prazos', href: '/admin/staff/calendar', status: 'working' },
                            { label: 'Gerar Documentos', href: '/admin/staff/document-generation', status: 'working' }
                        ]
                    },
                    // Portal Navigation (from Portal.tsx)
                    {
                        component: 'Portal Navigation',
                        type: 'client',
                        links: [
                            { label: 'Ver Todos (Cases)', href: '/portal/cases', status: 'working' },
                            { label: 'Ver Todos (Documents)', href: '/portal/documents', status: 'working' },
                            { label: 'Ver Detalhes (Financial)', href: '/portal/financial', status: 'working' },
                            { label: 'Abrir Chat (Messages)', href: '/portal/messages', status: 'working' },
                            { label: 'Minhas Assinaturas', href: '/portal/subscriptions', status: 'working' },
                            { label: 'Contratar Servi√ßo', href: '/portal/payment', status: 'working' }
                        ]
                    },
                    // Login Navigation
                    {
                        component: 'Login Navigation',
                        type: 'public',
                        links: [
                            { label: 'Voltar ao Site', href: '/', status: 'working' }
                        ]
                    }
                ];

                navigationTests.forEach(navTest => {
                    navTest.links.forEach(link => {
                        let status = 'pass';
                        let message = `Link "${link.label}" ‚Üí ${link.href} funcional`;
                        let issues = [];

                        if (link.status === 'placeholder') {
                            status = 'warning';
                            message = `Link "${link.label}" ‚Üí ${link.href} aponta para placeholder`;
                            issues.push('Destino n√£o implementado completamente');
                        } else if (link.status === 'broken') {
                            status = 'fail';
                            message = `Link "${link.label}" ‚Üí ${link.href} quebrado`;
                            issues.push('Link n√£o funciona ou retorna 404');
                        }

                        this.results.navigationTests.push({
                            component: navTest.component,
                            type: navTest.type,
                            label: link.label,
                            href: link.href,
                            status,
                            message,
                            issues
                        });

                        if (status === 'pass') this.stats.working++;
                        else if (status === 'fail') this.stats.broken++;
                        else if (status === 'warning') this.stats.warnings++;
                        this.stats.total++;
                    });
                });

                this.renderNavigationResults();
            }

            // Route Protection Analysis
            testRouteProtection() {
                console.log('üîí Testing Route Protection...');

                const protectionTests = [
                    // Protected Route Component (Client)
                    {
                        component: 'ProtectedRoute',
                        description: 'Cliente portal protection',
                        expectedBehavior: 'Redirect to /login if not authenticated',
                        actualBehavior: 'Uses useAuth() hook, redirects correctly',
                        status: 'pass',
                        issues: []
                    },
                    // Admin Protected Route Component
                    {
                        component: 'AdminProtectedRoute',
                        description: 'Admin panel protection',
                        expectedBehavior: 'Redirect to /login if not admin authenticated',
                        actualBehavior: 'Uses useAdminAuth() hook, checks user && adminUser',
                        status: 'pass',
                        issues: []
                    },
                    // Public Route Component
                    {
                        component: 'PublicRoute',
                        description: 'Public route redirect behavior',
                        expectedBehavior: 'Redirect to /portal if already authenticated',
                        actualBehavior: 'Uses useAuth() hook, redirects correctly',
                        status: 'pass',
                        issues: []
                    },
                    // Admin Public Route Component
                    {
                        component: 'AdminPublicRoute',
                        description: 'Admin public route redirect behavior',
                        expectedBehavior: 'Redirect to /admin if already authenticated as admin',
                        actualBehavior: 'Uses useAdminAuth() hook, redirects correctly',
                        status: 'pass',
                        issues: []
                    },
                    // Route Role-Based Access
                    {
                        component: 'AdminDashboard Role Check',
                        description: 'Admin vs Staff route access',
                        expectedBehavior: 'Show different routes based on adminUser.role',
                        actualBehavior: 'Correctly implements role-based routing',
                        status: 'pass',
                        issues: []
                    },
                    // Authentication Context Issues
                    {
                        component: 'Unified Login Context',
                        description: 'Dual auth context management',
                        expectedBehavior: 'Handle both client and admin auth in login',
                        actualBehavior: 'Uses both AuthProvider and AdminAuthProvider',
                        status: 'warning',
                        issues: ['Complex dual-context setup might cause conflicts']
                    }
                ];

                protectionTests.forEach(test => {
                    this.results.protectionTests.push(test);
                    
                    if (test.status === 'pass') this.stats.working++;
                    else if (test.status === 'fail') this.stats.broken++;
                    else if (test.status === 'warning') this.stats.warnings++;
                    this.stats.total++;
                });

                this.renderProtectionResults();
            }

            // Identify specific issues
            identifyIssues() {
                const issues = [];

                // Issue 1: Placeholder Routes
                const placeholderRoutes = this.results.routeDefinitions.filter(r => r.issues.includes('Componente n√£o implementado completamente'));
                if (placeholderRoutes.length > 0) {
                    issues.push({
                        category: 'Desenvolvimento Incompleto',
                        severity: 'medium',
                        count: placeholderRoutes.length,
                        description: `${placeholderRoutes.length} rotas apontam para componentes placeholder`,
                        routes: placeholderRoutes.map(r => r.path),
                        recommendation: 'Implementar componentes funcionais para estas rotas'
                    });
                }

                // Issue 2: Complex Authentication
                issues.push({
                    category: 'Complexidade de Autentica√ß√£o',
                    severity: 'low',
                    count: 1,
                    description: 'Sistema de autentica√ß√£o dual (cliente + admin) com contextos m√∫ltiplos',
                    routes: ['/login'],
                    recommendation: 'Monitorar poss√≠veis conflitos entre contextos de autentica√ß√£o'
                });

                // Issue 3: Route Nesting Complexity
                const adminRoutes = this.results.routeDefinitions.filter(r => r.type === 'admin' || r.type === 'staff');
                if (adminRoutes.length > 15) {
                    issues.push({
                        category: 'Complexidade de Roteamento',
                        severity: 'low',
                        count: adminRoutes.length,
                        description: 'Grande n√∫mero de rotas administrativas pode impactar performance',
                        routes: adminRoutes.map(r => r.path).slice(0, 5).concat(['...']),
                        recommendation: 'Considerar lazy loading para rotas administrativas'
                    });
                }

                // Issue 4: Missing 404 Handling
                const hasNotFound = this.results.routeDefinitions.some(r => r.path === '*');
                if (!hasNotFound) {
                    issues.push({
                        category: 'Tratamento de Erro',
                        severity: 'high',
                        count: 1,
                        description: 'Rota catch-all (*) n√£o encontrada',
                        routes: ['*'],
                        recommendation: 'Adicionar rota catch-all para tratar 404s'
                    });
                }

                // Issue 5: Redirect Logic
                const redirectRoutes = this.results.routeDefinitions.filter(r => r.type === 'redirect');
                redirectRoutes.forEach(route => {
                    if (route.path === '/admin/login') {
                        issues.push({
                            category: 'Redirecionamento',
                            severity: 'low',
                            count: 1,
                            description: 'Rota /admin/login redireciona para /login',
                            routes: [route.path],
                            recommendation: 'Verificar se redirecionamento est√° correto'
                        });
                    }
                });

                this.results.issues = issues;
                this.renderIssues();
            }

            // Render results
            renderRouteDefinitionResults() {
                const container = document.getElementById('routeDefinitionResults');
                container.innerHTML = '';

                this.results.routeDefinitions.forEach(result => {
                    const div = document.createElement('div');
                    div.className = `test-result border rounded p-3 ${result.status}`;
                    
                    div.innerHTML = `
                        <div class="flex items-center justify-between">
                            <div class="flex-1">
                                <div class="font-medium">${result.path}</div>
                                <div class="text-sm text-gray-600">${result.message}</div>
                                <div class="text-xs text-gray-500 mt-1">
                                    Component: ${result.component} | Type: ${result.type} | Protected: ${result.protected}
                                </div>
                                ${result.issues.length > 0 ? `
                                    <div class="text-xs text-orange-600 mt-1">
                                        Issues: ${result.issues.join(', ')}
                                    </div>
                                ` : ''}
                            </div>
                            <div class="ml-4">
                                <span class="px-2 py-1 text-xs rounded ${
                                    result.status === 'pass' ? 'bg-green-100 text-green-800' :
                                    result.status === 'fail' ? 'bg-red-100 text-red-800' :
                                    'bg-yellow-100 text-yellow-800'
                                }">
                                    ${result.status === 'pass' ? '‚úÖ OK' : result.status === 'fail' ? '‚ùå ERRO' : '‚ö†Ô∏è AVISO'}
                                </span>
                            </div>
                        </div>
                    `;
                    
                    container.appendChild(div);
                });
            }

            renderNavigationResults() {
                const container = document.getElementById('navigationResults');
                container.innerHTML = '';

                this.results.navigationTests.forEach(result => {
                    const div = document.createElement('div');
                    div.className = `test-result border rounded p-3 ${result.status}`;
                    
                    div.innerHTML = `
                        <div class="flex items-center justify-between">
                            <div class="flex-1">
                                <div class="font-medium">${result.component} - ${result.label}</div>
                                <div class="text-sm text-gray-600">${result.message}</div>
                                <div class="text-xs text-gray-500 mt-1">
                                    Target: ${result.href} | Type: ${result.type}
                                </div>
                                ${result.issues.length > 0 ? `
                                    <div class="text-xs text-orange-600 mt-1">
                                        Issues: ${result.issues.join(', ')}
                                    </div>
                                ` : ''}
                            </div>
                            <div class="ml-4">
                                <span class="px-2 py-1 text-xs rounded ${
                                    result.status === 'pass' ? 'bg-green-100 text-green-800' :
                                    result.status === 'fail' ? 'bg-red-100 text-red-800' :
                                    'bg-yellow-100 text-yellow-800'
                                }">
                                    ${result.status === 'pass' ? '‚úÖ OK' : result.status === 'fail' ? '‚ùå ERRO' : '‚ö†Ô∏è AVISO'}
                                </span>
                            </div>
                        </div>
                    `;
                    
                    container.appendChild(div);
                });
            }

            renderProtectionResults() {
                const container = document.getElementById('protectionResults');
                container.innerHTML = '';

                this.results.protectionTests.forEach(result => {
                    const div = document.createElement('div');
                    div.className = `test-result border rounded p-3 ${result.status}`;
                    
                    div.innerHTML = `
                        <div class="flex items-center justify-between">
                            <div class="flex-1">
                                <div class="font-medium">${result.component}</div>
                                <div class="text-sm text-gray-600">${result.description}</div>
                                <div class="text-xs text-gray-500 mt-1">
                                    Expected: ${result.expectedBehavior}
                                </div>
                                <div class="text-xs text-gray-500">
                                    Actual: ${result.actualBehavior}
                                </div>
                                ${result.issues.length > 0 ? `
                                    <div class="text-xs text-orange-600 mt-1">
                                        Issues: ${result.issues.join(', ')}
                                    </div>
                                ` : ''}
                            </div>
                            <div class="ml-4">
                                <span class="px-2 py-1 text-xs rounded ${
                                    result.status === 'pass' ? 'bg-green-100 text-green-800' :
                                    result.status === 'fail' ? 'bg-red-100 text-red-800' :
                                    'bg-yellow-100 text-yellow-800'
                                }">
                                    ${result.status === 'pass' ? '‚úÖ OK' : result.status === 'fail' ? '‚ùå ERRO' : '‚ö†Ô∏è AVISO'}
                                </span>
                            </div>
                        </div>
                    `;
                    
                    container.appendChild(div);
                });
            }

            renderIssues() {
                const container = document.getElementById('issuesFound');
                container.innerHTML = '';

                if (this.results.issues.length === 0) {
                    container.innerHTML = `
                        <div class="text-center py-8">
                            <div class="text-green-600 text-2xl mb-2">üéâ</div>
                            <div class="text-green-700 font-medium">Nenhum problema cr√≠tico encontrado!</div>
                            <div class="text-green-600 text-sm">O sistema de roteamento est√° funcionando corretamente.</div>
                        </div>
                    `;
                    return;
                }

                this.results.issues.forEach(issue => {
                    const div = document.createElement('div');
                    div.className = `border rounded p-4 ${
                        issue.severity === 'high' ? 'border-red-300 bg-red-50' :
                        issue.severity === 'medium' ? 'border-yellow-300 bg-yellow-50' :
                        'border-blue-300 bg-blue-50'
                    }`;
                    
                    div.innerHTML = `
                        <div class="flex items-start justify-between">
                            <div class="flex-1">
                                <div class="font-medium text-gray-900">${issue.category}</div>
                                <div class="text-sm text-gray-700 mt-1">${issue.description}</div>
                                <div class="text-xs text-gray-600 mt-2">
                                    <strong>Rotas afetadas:</strong> ${issue.routes.join(', ')}
                                </div>
                                <div class="text-xs text-gray-600 mt-1">
                                    <strong>Recomenda√ß√£o:</strong> ${issue.recommendation}
                                </div>
                            </div>
                            <div class="ml-4 flex items-center space-x-2">
                                <span class="px-2 py-1 text-xs rounded ${
                                    issue.severity === 'high' ? 'bg-red-100 text-red-800' :
                                    issue.severity === 'medium' ? 'bg-yellow-100 text-yellow-800' :
                                    'bg-blue-100 text-blue-800'
                                }">
                                    ${issue.severity === 'high' ? 'üö® ALTA' : issue.severity === 'medium' ? '‚ö†Ô∏è M√âDIA' : 'üí° BAIXA'}
                                </span>
                                <span class="px-2 py-1 text-xs bg-gray-100 text-gray-800 rounded">
                                    ${issue.count}
                                </span>
                            </div>
                        </div>
                    `;
                    
                    container.appendChild(div);
                });
            }

            updateStats() {
                document.getElementById('totalRoutes').textContent = this.stats.total;
                document.getElementById('workingRoutes').textContent = this.stats.working;
                document.getElementById('brokenRoutes').textContent = this.stats.broken;
                document.getElementById('warningRoutes').textContent = this.stats.warnings;
            }

            runAllTests() {
                this.results = {
                    routeDefinitions: [],
                    navigationTests: [],
                    protectionTests: [],
                    issues: []
                };
                this.stats = {
                    total: 0,
                    working: 0,
                    broken: 0,
                    warnings: 0
                };

                this.analyzeRouteDefinitions();
                this.testNavigationComponents();
                this.testRouteProtection();
                this.identifyIssues();
                this.updateStats();

                console.log('‚úÖ All routing and navigation tests completed!');
            }

            exportResults(format) {
                const data = {
                    timestamp: new Date().toISOString(),
                    stats: this.stats,
                    results: this.results
                };

                if (format === 'json') {
                    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `mini-prima-routing-test-${new Date().toISOString().split('T')[0]}.json`;
                    a.click();
                    URL.revokeObjectURL(url);
                } else if (format === 'csv') {
                    // Simple CSV export
                    let csv = 'Type,Path,Component,Status,Issues\n';
                    
                    this.results.routeDefinitions.forEach(r => {
                        csv += `Route,${r.path},${r.component},${r.status},"${r.issues.join('; ')}"\n`;
                    });
                    
                    this.results.navigationTests.forEach(r => {
                        csv += `Navigation,${r.href},${r.component} - ${r.label},${r.status},"${r.issues.join('; ')}"\n`;
                    });

                    const blob = new Blob([csv], { type: 'text/csv' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `mini-prima-routing-test-${new Date().toISOString().split('T')[0]}.csv`;
                    a.click();
                    URL.revokeObjectURL(url);
                }
            }
        }

        // Initialize tester
        const tester = new RoutingNavigationTester();

        // Event listeners
        document.getElementById('testAllRoutes').addEventListener('click', () => {
            tester.analyzeRouteDefinitions();
            tester.updateStats();
        });

        document.getElementById('testNavigation').addEventListener('click', () => {
            tester.testNavigationComponents();
            tester.updateStats();
        });

        document.getElementById('testProtection').addEventListener('click', () => {
            tester.testRouteProtection();
            tester.updateStats();
        });

        document.getElementById('exportResults').addEventListener('click', () => {
            document.getElementById('exportModal').classList.remove('hidden');
            document.getElementById('exportModal').classList.add('flex');
        });

        document.getElementById('closeModal').addEventListener('click', () => {
            document.getElementById('exportModal').classList.add('hidden');
            document.getElementById('exportModal').classList.remove('flex');
        });

        document.getElementById('exportJSON').addEventListener('click', () => {
            tester.exportResults('json');
            document.getElementById('exportModal').classList.add('hidden');
            document.getElementById('exportModal').classList.remove('flex');
        });

        document.getElementById('exportCSV').addEventListener('click', () => {
            tester.exportResults('csv');
            document.getElementById('exportModal').classList.add('hidden');
            document.getElementById('exportModal').classList.remove('flex');
        });

        // Auto-run all tests on page load
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                tester.runAllTests();
            }, 500);
        });
    </script>
</body>
</html>